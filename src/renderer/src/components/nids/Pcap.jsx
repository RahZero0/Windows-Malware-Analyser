import { useState } from 'react'
import { Loader } from '../renderer/Loader'
import { Donut } from '../renderer/Donut'

const Pcap = () => {
  const [resultDiv, setResultDiv] = useState('')
  const main = async (e) => {
    e.preventDefault()
    setResultDiv('')
    const input = document.querySelector('.file-input')
    input.style.display = 'none'
    const loader = document.querySelector('.loader')
    loader.style.display = 'block'
    let data = []
    try {
      const file = document.getElementById('fileInput').files
      const result = await window.api.capturecap(`${file[0].path}`)
      Object.entries(result).forEach(([key, value]) => {
        const temp = {
          title: key,
          value: value || null // Adjust based on your actual data structure
        }
        data.push(temp)
      })
      loader.style.display = 'none'
      setResultDiv(<Donut data={data} detail="Flows" />)
      loader.style.display = 'none'
      console.log('done model test')
    } catch (error) {
      console.error(error)
    }
  }
  return (
    <div className="pdf">
      {/* <h2>Pcap Analysis</h2> */}
      <h3>Input files in .pcap</h3>
      <div className="file-input">
        <div className="ring">
          <i></i>
          <i></i>
          <i></i>
          <form id="fileForm" onSubmit={main}>
            <div className="login">
              <h4>Give Pcap File</h4>
              <div className="inputBx">
                <input type="file" id="fileInput" name="fileInput" accept=".pcap" />
              </div>
              <button className="file-submit" type="submit">
                Submit
              </button>
            </div>
          </form>
        </div>
      </div>
      <Loader />
      <div className="result">{resultDiv}</div>
    </div>
  )
}

export { Pcap }
