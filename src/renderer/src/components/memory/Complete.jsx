import { Loader } from '../renderer/Loader'
import { useState } from 'react'
import { Donut } from '../renderer/Donut'

const Complete = () => {
  const [resultDiv, setResultDiv] = useState('')
  const main = async () => {
    const button = document.querySelector('.complete-input')
    button.style.display = 'none'
    const loader = document.querySelector('.loader')
    loader.style.display = 'block'
    let result
    try {
      console.log('Creating Memory Dump....')
      await window.api.invokeCreateMemdump('MRCv120.exe', ['/accepteula', '/go', '/silent'])
      console.log('Fetching data from memory dump....')
      await window.api.processdump()
      console.log('Running through the csv maker....')
      await window.api.customfile()
      console.log('Done preparing csv as input')
      console.log('starting model test')
      result = await window.api.testmodel()
      const data = [
        {
          title: 'Benign',
          value: result.Begnign
        },
        {
          title: 'Ransomware',
          value: result.Ransomware
        },
        {
          title: 'Spyware',
          value: result.Spyware
        },
        {
          title: 'Trojan',
          value: result.Trojan
        }
      ]
      setResultDiv(<Donut data={data} detail="Probability" />)
      button.style.display = 'block'
      loader.style.display = 'none'
    } catch (error) {
      console.error(error)
    }
  }
  return (
    <div className="complete">
      <div className="complete-input">
        <h3>Click scan to completely scan your device</h3>
        <button className="ui-btn complete-button" onClick={main}>
          <span>Scan</span>
        </button>
      </div>
      <div className="result">{resultDiv}</div>
      <Loader />
    </div>
  )
}

export { Complete }
